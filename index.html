<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitemap URLs</title>
</head>
<body>
    <div id="count"></div>
    <div id="urlList"></div>

    <script>
        async function loadSitemapUrls() {
            try {
                const BATCH_SIZE = 10000; // 每批显示的URL数量
                let allUrls = [];
                let displayedCount = 0;
                
                // 获取主站点地图
                const indexResponse = await fetch('/sitemap.xml');
                const indexText = await indexResponse.text();
                const parser = new DOMParser();
                const indexDoc = parser.parseFromString(indexText, 'text/xml');
                
                const sitemapUrls = Array.from(indexDoc.getElementsByTagName('loc')).map(loc => loc.textContent);
                
                // 更新总数显示
                const updateCount = () => {
                    document.getElementById('count').textContent = `已加载 ${allUrls.length} 个URL，已显示 ${displayedCount} 个URL`;
                };
                
                // 分批显示URL
                const displayUrls = (urls, start) => {
                    const end = Math.min(start + BATCH_SIZE, urls.length);
                    const batch = urls.slice(start, end);
                    const urlListHtml = batch.map(url => `<a href="${url}">${url}</a><br>`).join('');
                    document.getElementById('urlList').insertAdjacentHTML('beforeend', urlListHtml);
                    displayedCount = end;
                    updateCount();
                    
                    // 如果还有未显示的URL，安排下一批显示
                    if (end < urls.length) {
                        setTimeout(() => displayUrls(urls, end), 100);
                    }
                };
                
                // 处理每个子站点地图
                for (const sitemapUrl of sitemapUrls) {
                    const response = await fetch(sitemapUrl);
                    const text = await response.text();
                    const doc = parser.parseFromString(text, 'text/xml');
                    const urls = Array.from(doc.getElementsByTagName('loc')).map(loc => loc.textContent);
                    allUrls = allUrls.concat(urls);
                    updateCount();
                }
                
                // 开始分批显示URL
                displayUrls(allUrls, 0);
                
            } catch (error) {
                console.error('加载站点地图失败:', error);
                document.getElementById('urlList').textContent = '加载失败: ' + error.message;
            }
        }

        loadSitemapUrls();
    </script>
</body>
</html>